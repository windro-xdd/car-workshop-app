// Kripa Car Care Workshop - Database Schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// Users for multi-user support
model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String   // bcrypt hash
  name      String
  role      String   @default("staff") // admin, manager, staff
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  invoices Invoice[]

  @@map("users")
}

// Items Inventory
model Item {
  id        String   @id @default(cuid())
  code      String   @unique
  name      String
  category  String
  unitPrice Float
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  lineItems LineItem[]

  @@map("items")
}

// Invoices
model Invoice {
  id                String   @id @default(cuid())
  invoiceNumber     String   @unique
  invoiceDate       DateTime @default(now())
  customerName      String
  customerPhone     String?
  customerEmail     String?
  vehicleNumber     String?
  vehicleModel      String?
  grossAmount       Float    @default(0)
  gstAmount         Float    @default(0)
  netTotal          Float    @default(0)
  gstPercentage     Float    @default(18.0)
  status            String   @default("Draft") // Draft, Final, Cancelled
  isAmendment       Boolean  @default(false)
  originalInvoiceId String?
  notes             String?
  userId            String
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  // Relations
  user      User     @relation(fields: [userId], references: [id])
  lineItems LineItem[]

  @@map("invoices")
}

// Line Items (Invoice Details)
model LineItem {
  id        String  @id @default(cuid())
  invoiceId String
  itemId    String
  quantity  Float
  unitPrice Float
  lineTotal Float   @default(0)
  remarks   String?

  // Relations
  invoice Invoice @relation(fields: [invoiceId], references: [id], onDelete: Cascade)
  item    Item   @relation(fields: [itemId], references: [id])

  @@map("line_items")
}

// GST Configuration
model GstConfig {
  id       String  @id @default(cuid())
  rate     Float   @default(18.0)
  isActive Boolean @default(true)

  @@map("gst_config")
}

// Business Configuration (GSTIN, logo, etc.)
model BusinessConfig {
  id        String  @id @default(cuid())
  gstin     String  @default("")
  logoPath  String  @default("")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("business_config")
}

// Backup Tracking
model Backup {
  id        String   @id @default(cuid())
  filePath  String
  size      Int
  createdAt DateTime @default(now())

  @@map("backups")
}
